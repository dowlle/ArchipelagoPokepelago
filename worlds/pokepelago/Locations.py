from BaseClasses import Location
from .data import POKEMON_DATA, GEN_1_TYPES

# Shifted away from item IDs (8574000) to prevent collisions.
LOCATION_ID_OFFSET = 8560000

# We create a dictionary of all the locations where items can be hidden.
location_table = {}

# 1. "Oak's Lab" Starting Locations (Free checks to kickstart the logic)
starting_locations = [
    "Oak's Parcel Delivery", "Pokedex Received", "Mom's Running Shoes", "Town Map Received",
    "Professor Oak's Advice", "Boulder Badge (Replica)", "Old Amber (Replica)", "Helix Fossil (Replica)",
    "Dome Fossil (Replica)", "Silph Co. Pass", "Ticket to Cinnabar", "S.S. Ticket (Replica)",
    "Secret Key (Replica)", "Bike Voucher (Replica)", "Gold Teeth (Replica)", "Card Key (Replica)",
    "Lift Key (Replica)", "Silph Scope (Replica)", "Poke Flute (Replica)", "Item Finder (Replica)"
]
for i, name in enumerate(starting_locations):
    location_table[name] = LOCATION_ID_OFFSET + 100_000 + i

# 2. Pokémon Guess Locations (The core grid)
for mon in POKEMON_DATA:
    location_table[f"Guess {mon['name']}"] = LOCATION_ID_OFFSET + mon["id"]

# 3. Global Milestone Locations (Rewards for total catches)
# We start with 3 Pokémon (Bulbasaur, Charmander, Squirtle).
# For Gen 1 max new is 148, Gen 2 is 248, Gen 3 is 383, Gen 4 is 490, Gen 5 is 646, 
# Gen 6 is 718, Gen 7 is 806, Gen 8 is 895, Gen 9 is 1022.
milestones = [1, 5, 10] + list(range(20, 1031, 10)) + [148, 248, 383, 490, 646, 718, 806, 895, 1022]
# Deduplicate and sort
milestones = sorted(list(set(milestones)))

for count in milestones:
    location_table[f"Guessed {count} Pokemon"] = LOCATION_ID_OFFSET + 10_000 + count

# 4. Type-Specific Milestones
# Calculate how many of each type exist.
type_counts = {t: 0 for t in GEN_1_TYPES}
for mon in POKEMON_DATA:
    for t in mon["types"]:
        if t in type_counts:
            type_counts[t] += 1

# Starters: Bulbasaur (Grass/Poison), Charmander (Fire), Squirtle (Water).
starter_type_counts = {
    "Grass": 1,
    "Poison": 1,
    "Fire": 1,
    "Water": 1
}

milestone_steps = [1, 2, 5, 10, 15, 20, 30, 40, 50]
for p_type in GEN_1_TYPES:
    # Max NEW catches = Total in type - starters in that type
    max_new = type_counts[p_type] - starter_type_counts.get(p_type, 0)
    for step in milestone_steps:
        if step <= max_new:
            location_table[f"Caught {step} {p_type} Pokemon"] = LOCATION_ID_OFFSET + 20_000 + (GEN_1_TYPES.index(p_type) * 1000) + step

class PokepelagoLocation(Location):
    game: str = "Pokepelago"